<mat-card *ngIf="!fullCard" class="slim-ride-card" (click)="openRide()">
  <div class="ride-card-content">
    <div class="departing">
      <span>{{ride.departureDate | date: 'MMM d'}}</span>
      <span>{{ride.departureTime}}</span>
    </div>
    <div class="start-location">
      {{ride.origin}}
    </div>
    <div class="end-location">
      {{ride.destination}}
    </div>
  </div>
  <!--<div *ngIf="!ride.isDriving" class="needs-driver">-->
    <!--NEEDS DRIVER-->
  <!--</div>-->
</mat-card>

<mat-card *ngIf="fullCard" class="full-ride-card">

  <mat-card-header class="ride-title-isDriving" [id]="ride._id.$oid">

    <div class="route">
      <div class="ride-info origin">{{ride.origin}}</div>
      <mat-icon>play_arrow</mat-icon>
      <div class="ride-info destination">{{ride.destination}}</div>
    </div>

    <div class="menu_spacer"></div>

    <button mat-icon-button [matMenuTriggerFor]="menu" id="settingsDriving" class="card-top-right-button">
      <mat-icon class="dots">more_vert</mat-icon>
    </button>
    <mat-menu #menu="matMenu">
      <div *ngIf="userOwnsThisRide(ride)">
        <button mat-menu-item
                (click)="giveRideToService(ride)"
                id="editDialogOpen"
                routerLink="/editride">
          <span>Edit Ride</span>
        </button>
        <button mat-menu-item
                (click)="openDeleteDialog(ride._id)"
                id="deleteDialogOpen" >
          <span>Delete Ride</span>
        </button>
      </div>
    </mat-menu>
  </mat-card-header>

  <mat-card-content>
    <div class="departure-and-seats">
      <div class="departure-time">
        <div *ngIf="!checkImpossibleDate(ride); then possible_date else impossible_date"> </div>
        <ng-template #possible_date > {{this.dateParse(ride.departureDate)}} </ng-template>
        <ng-template #impossible_date> Unspecified date </ng-template>

        at

        <div *ngIf="!checkImpossibleTime(ride); then possible_time else impossible_time"> </div>
        <ng-template #possible_time > {{this.hourParse(ride.departureTime)}} </ng-template>
        <ng-template #impossible_time> unspecified time </ng-template>
      </div>

      <div class="seats-left" *ngIf="ride.seatsAvailable">
        <small *ngIf="ride.seatsAvailable === 1"> {{ride.seatsAvailable}} SEAT LEFT </small>
        <small *ngIf="ride.seatsAvailable !== 1"> {{ride.seatsAvailable}} SEATS LEFT </small>
      </div>
    </div>

    <h3>Passengers</h3>
    <mat-list>
      <mat-list-item *ngFor="let person of people" class="person">
        <img matListAvatar [src]="person.pictureUrl" alt="avatar">
        <h3 matLine>{{person.fullName}}</h3>
        <mat-chip *ngIf="person.userId == ride.driverID">DRIVER</mat-chip>
      </mat-list-item>
    </mat-list>

    <div id="ride-info-driver-id-isDriving" class="ride-info driver" *ngIf="ride.isDriving">
      <a routerLink="/profile/{{ride.ownerID}}">{{ride.owner}}</a> is offering this ride
    </div>

    <div id="ride-info-driver-id" class="ride-info driver" *ngIf="!ride.isDriving">
      <a routerLink="/profile/{{ride.ownerID}}">{{ride.owner}}</a> is requesting this ride

    </div>

    <div *ngIf="ride.nonSmoking || ride.roundTrip">
      <mat-chip-list>
        <mat-chip *ngIf="ride.nonSmoking">Smoke free</mat-chip>
        <mat-chip *ngIf="ride.roundTrip">Round trip</mat-chip>
      </mat-chip-list>
    </div>

    <mat-divider [inset]="true" *ngIf="ride.notes"></mat-divider>

    <div class = "passengers" *ngIf="ride.isDriving">
      {{this.listRidePassengers(ride.passengerNames)}}
    </div>

    <mat-divider [inset]="true" *ngIf="ride.notes"></mat-divider>

    <div *ngIf="ride.notes" class="ride-info notes">
      <small>NOTES:</small>
      <div>{{ride.notes}}</div>
    </div>
  </mat-card-content>

  <mat-card-actions>
    <button
      *ngIf="this.userCanJoinRide(ride)"
      mat-raised-button
      class="join-ride-button"
      id="join-ride-button"
      color="primary"
      type="button"
      (click) = "joinRide(ride._id, this.currUserId, this.currUserFullName)">
      Request Ride
    </button>
    <button
      *ngIf="userIsAPassenger(ride)"
      id="leave-ride-button"
      mat-raised-button
      color="warn"
      (click)="leaveRide(this.currUserId, ride._id.$oid)">Leave Ride
    </button>
  </mat-card-actions>

</mat-card>
